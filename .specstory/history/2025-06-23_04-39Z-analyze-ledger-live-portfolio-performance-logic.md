<!-- Generated by SpecStory -->

# Analyze Ledger Live portfolio performance logic (2025-06-23 04:39Z)

_**User**_

You are a senior software engineer with expertise in React Native, TypeScript, and advanced financial data rendering in UI components.

Task:
Analyze how the real Ledger Live mobile app calculates and renders portfolio percentage gain/loss over timeframes such as '1Y' or 'All'. This includes reviewing the logic in the following components:
	•	@Delta.tsx
	•	@AssetRowLayout.tsx
	•	@CounterValue.tsx
	•	@PortfolioAssets.tsx
	•	@GraphCard.tsx

Objectives:
	1.	Determine how Ledger calculates overall portfolio performance over a selected timeframe.
	2.	Confirm whether the app tracks individual crypto daily % changes, or if it instead computes portfolio value snapshots (e.g., month-by-month) and derives % change based on historical portfolio valuations.
	3.	Extract and explain the key logic and data flow used to calculate those deltas.
	4.	Document your findings and breakdown in a new Markdown file: deltadynamic.md.  	Ensure the output is structured clearly so it can serve as a direct reference for implementing the same logic in our own portfolio tracking components.

Expected Output:
	•	A complete deltadynamic.md file
	•	Includes:
	•	Explanation of Ledger’s delta calculation method
	•	Description of how and where historical data is used
	•	Key component roles in rendering the % gain
	•	Insights on how the UI updates with timeframe selection 


---

_**Assistant**_

<think><details><summary>Thought Process</summary>The user wants me to analyze how the real Ledger Live mobile app calculates and renders portfolio percentage gain/loss over timeframes. They've provided several key component files and want me to:

1. Determine how Ledger calculates overall portfolio performance over a selected timeframe
2. Confirm whether the app tracks individual crypto daily % changes, or if it instead computes portfolio value snapshots and derives % change based on historical portfolio valuations
3. Extract and explain the key logic and data flow used to calculate those deltas
4. Document my findings and breakdown in a new Markdown file: deltadynamic.md

Let me analyze the provided files:

1. **Delta.tsx** - This component seems to handle rendering percentage/value changes with arrows and colors
2. **AssetRowLayout.tsx** - This renders individual asset rows with their balances and changes
3. **CounterValue.tsx** - This handles counter value calculations (converting crypto values to fiat)
4. **PortfolioAssets.tsx** - This shows the portfolio assets list
5. **GraphCard.tsx** - This renders the main portfolio graph card with balance and changes

Let me analyze each component:

### Delta.tsx Analysis:
- Takes a `valueChange` prop of type `ValueChange` 
- Can display either percentage or value changes
- Has logic to determine if it should show percentages or absolute values
- Uses `valueChange.percentage` and `valueChange.value` properties
- Shows green/red colors and up/down arrows based on positive/negative changes
- The key calculation seems to be: `const delta = (percent || isPercentSignDisplayed) && valueChange.percentage ? valueChange.percentage * 100 : valueChange.value;`

### AssetRowLayout.tsx Analysis:
- Takes `countervalueChange?: ValueChange` as a prop
- Passes this to the Delta component: `<Delta percent show0Delta={balance.toNumber() !== 0} fallbackToPercentPlaceholder valueChange={countervalueChange} />`


- The percentage calculation logic is embedded within the ValueChange object passed down through components

### CounterValue.tsx Analysis:
The component focuses on converting cryptocurrency values to fiat currency equivalents. It leverages the `useCalculate` hook from live-countervalues-react to perform these conversions. While it handles currency transformations, it doesn't directly manage percentage calculations. The hook takes a currency, value, and optional date to generate fiat countervalues.

### PortfolioAssets.tsx Analysis:
This component primarily manages asset organization and display. It utilizes the `useDistribution` hook to retrieve asset distribution information. The focus is on structuring and presenting asset data rather than performing direct delta calculations.

### GraphCard.tsx Analysis: 
I see the component receives a `portfolio` prop and extracts critical delta calculation data. It uses `countervalueChange` and `balanceHistory` to render Delta components. The Delta rendering includes percentage and unit-based value changes, with time range selection managed through the `useTimeRange()` hook.

The ValueChange object emerges as a crucial data structure, containing percentage and absolute value change information. The Portfolio type encapsulates this data, enabling comprehensive financial tracking and visualization.

The calculation logic appears abstracted away from the component, with pre-calculated changes passed as props. Time range interactions dynamically update the displayed financial metrics, suggesting a responsive data management approach.

The portfolio tracking mechanism focuses on aggregate snapshots, comparing total portfolio values across different time periods. Components receive processed data, enabling clean separation between data preparation and visualization layers.</details></think>

---

I'll analyze the provided Ledger Live mobile components to understand how they calculate and render portfolio percentage gain/loss over timeframes. Let me examine the code flow and data structures.

---

Cancelled

---

