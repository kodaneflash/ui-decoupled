<!-- Generated by SpecStory -->

# Debugging invisible percentage in Delta component (2025-07-06 13:10Z)

_**User**_

You are a senior software engineer, specializing in mobile development, react-native and typescript. Analyze related components from ledger-live-mobile directory to replicate for 100% fidelity and consistent behavior. Why would the Delta component log "SHOWING" with correct data but the percentage/arrow not appear in the UI? The component claims to return JSX with the percentage, but it's invisible. What could cause this rendering issue where debug logs show success but UI shows nothing?
Note: Do not suggest changing import paths or major refactoring - need minimal fix to make calculated percentages actually visible. Issue Summary
React Native app displays percentage changes correctly in debug logs but percentages and arrows are invisible in the UI on 1d/1w timeframes.
Current Behavior
Debug logs show: Delta component calculates -2.53% → rounds to -3% → logs "SHOWING: 3%" with correct color/sign
UI shows: Only dollar amounts like (-$32,333.07), no percentage or arrows visible
Expected: Should show both 3% with downward arrow AND dollar amount Data Flow Context
AssetRowLayout receives countervalueChange data
Passes to Delta component with props: percent={true}, show0Delta={true}, fallbackToPercentPlaceholder={true}
Delta calculates correctly and logs "SHOWING" but UI doesn't display it  [Delta percent] Input: {"percentage": -0.025279603944850453, "value": -23958.21569715402}
[Delta percent] Calculation: {"delta": -2.5279603944850453, "roundedDelta": -3, "willShow": true}
[Delta percent] SHOWING: {"displayValue": "3%", "color": "error.c50", "sign": "-"} Component Structure // AssetRowLayout calls Delta like this:
<Delta
  percent
  show0Delta={balance.toNumber() !== 0}
  fallbackToPercentPlaceholder
  valueChange={countervalueChange}
/> 
   A

---

_**Assistant**_

<think><details><summary>Thought Process</summary>The user is experiencing an issue where the Delta component is logging "SHOWING" with correct data but the UI isn't displaying the percentage/arrow. This is a classic React Native rendering issue where components are being rendered but with zero opacity, incorrect positioning, or layout issues.

Looking at the logs, they show:
```
[Delta percent] SHOWING: {"displayValue": "3%", "color": "error.c50", "sign": "-"}
```

But in the UI, they're only seeing dollar amounts like (-$32,333.07), no percentage or arrows visible.

Let me analyze the Delta component code to understand what could be causing this:

1. The Delta component is receiving the correct data
2. It's calculating the percentage correctly
3. It's logging "SHOWING" which means it's reaching the return statement with JSX
4. But the UI isn't showing the percentage/arrow

Looking at the Delta component code, I can see a few potential issues:

1. **Return statement logic**: The component has complex conditional logic that might be causing it to return null or incorrect JSX
2. **Style issues**: The flexDirection, alignItems, or other styling might be causing the component to render but be invisible
3. **Color issues**: The color prop might be resolving to transparent or invalid
4. **Text rendering**: The Text component might have issues with the content

Let me examine the return statement more carefully:

```jsx
return (
  <View style={[styles.root, style]}>
    {percent && isArrowDisplayed ? <ArrowIcon size={20} color={color} /> : null}
    <View style={percent ? styles.content : null}>
      <Text
        fontWeight={isPercentSignDisplayed ? undefined : "semiBold"}
        variant={"large"}
        color={color}
      >
        {unit && absDelta !== 0 ? (
          <CurrencyUnitValue
            before={isPercentSignDisplayed ? sign : `(${sign}`}
            after={isPercentSignDisplayed ? "" : ")"}
            unit={unit}
            value={absDelta}
          />
        ) : percent ? (
          `${absDelta.toFixed(0)}%`
        ) : null}
        {range && ` (${getTimeRangeLabel(range)})`}
        {isPercentSignDisplayed ? "%" : ""}
      </Text>
    </View>
  </View>
);
```

The conditional rendering looks tricky. When `unit` is present, it prioritizes the `CurrencyUnitValue` rendering. If `unit` is undefined, it should fall back to showing the percentage. However, the nested conditions might be preventing the percentage from displaying correctly. The logic seems to have multiple branching paths that could potentially suppress the percentage rendering.

I'll investigate the arrow and text content rendering strategies. The arrow should appear when both `percent` and `isArrowDisplayed` are true, which seems straightforward. The text content requires careful condition checking to ensure the right value displays based on `unit`, `percent`, and `absDelta`.

Comparing with similar components in the codebase might reveal a more robust rendering pattern. The goal is to create a clear, predictable display mechanism that handles different data scenarios gracefully.</details></think>

---

Looking at the Delta component code and the debug logs, I can see the issue. The component is calculating correctly and reaching the return statement, but there are likely some styling or conditional rendering issues causing the UI to not display properly.

Let me analyze the actual ledger-live-mobile Delta component to understand the exact behavior:

---

<details>
            <summary>Searched codebase "Delta component implementation in ledger-live-mobile" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `ledger-live/knip.json` | L50-112 |
| `ledger-live/libs/ui/packages/native/src/components/Layout/List/VerticalTimeline/TimelineIndicator.tsx` | L52-83 |
| `ledger-live/apps/ledger-live-mobile/package.json` | L102-146 |
| `ledger-live/libs/ledger-live-common/src/wallet-api/react.ts` | L1057-1118 |
| `ledger-live/patches/rn-fetch-blob@0.12.0.patch` | L1-13 |
| `ledger-live/package.json` | L229-264 |
| `ledger-live/libs/ledger-live-common/src/hw/actions/app.ts` | L1-25 |
| `ledger-live/libs/ledger-live-common/src/wallet-api/react.ts` | L1009-1034 |
| `ledger-live/libs/ledger-live-common/src/wallet-api/LocalLiveAppProvider/types.ts` | L1-7 |
| `ledger-live/libs/ledgerjs/packages/types-live/src/portfolio.ts` | L25-34 |
| `ledger-live/apps/ledger-live-mobile/__mocks__/react-native-locale.ts` | L1-42 |
| `ledger-live/libs/ledger-live-common/src/hw/actions/app.ts` | L497-564 |
| `ledger-live/libs/ledger-live-common/src/wallet-api/react.ts` | L946-997 |
| `ledger-live/libs/live-wallet/src/store.ts` | L265-274 |
| `ledger-live/libs/live-wallet/src/store.ts` | L185-190 |
| `ledger-live/libs/live-wallet/src/walletsync/modules/accounts.ts` | L29-98 |
| `ledger-live/libs/live-wallet/src/walletsync/types.ts` | L1-58 |
| `ledger-live/apps/ledger-live-mobile/CHANGELOG.md` | L4849-4887 |
| `ledger-live/apps/ledger-live-mobile/CHANGELOG.md` | L5048-5086 |
| `ledger-live/libs/ledger-live-common/src/wallet-api/LocalLiveAppProvider/index.tsx` | L13-30 |
| `ledger-live/apps/ledger-live-mobile/CHANGELOG.md` | L5339-5387 |
| `ledger-live/libs/coin-modules/coin-cardano/src/logic.ts` | L254-294 |
| `ledger-live/CODEOWNERS` | L128-153 |
| `ledger-live/apps/ledger-live-mobile/CHANGELOG.md` | L2712-2757 |
| `ledger-live/libs/live-countervalues/src/portfolio.ts` | L218-232 |

</details>

---

